(function(o,t){typeof exports=="object"&&typeof module<"u"?t(exports,require("vue"),require("axios"),require("moment")):typeof define=="function"&&define.amd?define(["exports","vue","axios","moment"],t):(o=typeof globalThis<"u"?globalThis:o||self,t(o.VueHelpers={},o.Vue,o.axios,o.moment))})(this,function(o,t,h,w){"use strict";var K=Object.defineProperty;var X=(o,t,h)=>t in o?K(o,t,{enumerable:!0,configurable:!0,writable:!0,value:h}):o[t]=h;var d=(o,t,h)=>(X(o,typeof t!="symbol"?t+"":t,h),h);const V=s=>s&&typeof s=="object"&&"default"in s?s:{default:s},m=V(h),y=V(w);class p{constructor(){d(this,"loading",t.ref(!1));d(this,"result",t.ref([]))}static create(){return new p}async search(e,a){this.loading.value=!0,this.result.value=[];const{data:r}=await m.default.post(`${e}/search`,a).catch(i=>{throw this.loading.value=!1,i});this.result.value=r.result,this.loading.value=!1}async restore(e,a){this.loading.value=!0,this.result.value=[];const{data:r}=await m.default.post(`${e}/restore`,a).catch(i=>{throw this.loading.value=!1,i});return this.loading.value=!1,r}}const g=t.reactive({default:[]});function b(){return{createBag(s){g[s]=[]},set(s,e="default"){throw s.response&&s.response.data&&s.response.data.errors&&(g[e]=Object.keys(s.response.data.errors).map(r=>({key:r,message:s.response.data.errors[r][0]}))),s},get(s,e="default"){const a=g[e];if(!a)return{message:"",variant:""};const r=a.find(i=>i.key===s);return r?{message:r.message,variant:"danger"}:{message:"",variant:""}},clear(s,e="default"){if(s){const a=g[e];if(!a){console.warn(`Bag ${e} is not defined.`);return}const r=a.findIndex(i=>i.key===s);a.splice(r,1);return}g[e]=[]}}}class _{constructor(e){d(this,"loadPath","");d(this,"submitPath","");d(this,"bag","default");d(this,"model",t.reactive({}));d(this,"form",t.reactive({}));d(this,"original",t.reactive({}));d(this,"isLoading",t.ref(!1));d(this,"isLoaded",t.ref(!0));d(this,"isSubmitting",t.ref(!1));d(this,"isSubmitted",t.ref(!1));d(this,"errors",null);this.setPath(e.submitPath),this.loadPath=e.loadPath,this.setErrors(e.errorBag),this.setAttributes(e.form)}static create(e){return new _(e)}setPath(e){this.submitPath=e}setErrors(e){this.bag=e,this.errors=b(),this.errors.createBag(this.bag)}setAttributes(e){Object.assign(this.form,e),Object.assign(this.original,e)}getError(e){return this.errors.get(e,this.bag)}clearError(e){this.errors.clear(e,this.bag)}async submit(e,a,r={}){this.errors.clear(null,this.bag),this.isSubmitting.value=!0,this.isSubmitted.value=!1;const i=a?a(Object.assign({},this.form)):JSON.parse(JSON.stringify(this.form)),{data:l}=await m.default[r.method||"post"](e||this.submitPath,i,r).catch(u=>{throw this.isSubmitting.value=!1,this.errors.set(u,this.bag),u});return this.errors.clear(null,this.bag),Object.assign(this.original,JSON.parse(JSON.stringify(this.form))),this.isSubmitting.value=!1,this.isSubmitted.value=!0,l}async advancedSubmit(e){this.isSubmitting.value=!0,this.isSubmitted.value=!1;const{data:a}=await Promise.resolve(e(m.default,this.form)).catch(r=>{throw this.isSubmitting.value=!1,this.errors.set(r,this.bag),r});return this.isSubmitting.value=!1,this.isSubmitted.value=!0,a}async load(e,a){this.isLoading.value=!0,this.isLoaded.value=!1;const{data:r}=await m.default.get(e||this.loadPath,{params:a}).catch(i=>{throw this.isLoading.value=!1,this.isLoaded.value=!1,i});return this.setAttributes(r.form),r.model&&Object.assign(this.model,r.model),this.isLoading.value=!1,this.isLoaded.value=!0,r}reset(){Object.assign(this.form,JSON.parse(JSON.stringify(this.original)))}}class ${constructor(){d(this,"structure",{});d(this,"query",t.reactive({items:[],perPage:0,total:0,isLoading:!1,isLoaded:!1,isFilterActive:!1}));d(this,"params",t.reactive({page:1}));d(this,"router",null)}static create(e,a={},r={},i){r=Object.assign({base:"/api/admin",route:`${e}.index`},r);const l=r.base;console.log("index",r);const u={route:r.route,index:r.index||`${l}/${e}/index`,destroy:`${l}/${e}/destroy`},n=new this;return n.options=r,n.structure=a,n.params=Object.assign(n.params,a),n.router=i,n.urls=u,n}async fetch(e){this.query.isLoading=!0,this.query.isLoaded=!1;const{data:a}=await m.default.get(e||this.urls.index,{params:this.params}).catch(r=>{throw this.query.isLoading=!1,r});return await this.router.push({name:this.urls.route,query:this.params}),this.query.isLoading=!1,this.query.isLoaded=!0,a}async load(e){const a=await this.fetch(e);return Object.assign(this.query,a.query,{items:a.query.items.map(r=>({...r,isProcessing:!1}))}),a}onPageChange(e){return this.params.page=e,this.load()}async action(e,{row:a,index:r,remove:i,method:l},u={}){a.isProcessing=!0;const n={id:a.id,...u};if(l==="delete"){const{data:c}=await m.default.delete(e,{data:n}).catch(q=>{throw a.isProcessing=!1,q});a.isProcessing=!1,c.row&&Object.assign(a,c.row)}else{const{data:c}=await m.default.post(e,n).catch(q=>{throw a.isProcessing=!1,q});a.isProcessing=!1,c.row&&Object.assign(a,c.row)}if(i){const c=await this.fetch();if(this.query.items.splice(r,1),!c.query.items.length){this.params.page--,await this.load();return}this.query.items.length<c.query.items.length&&this.query.items.push(c.query.items[c.query.items.length-1])}}destroy(e,a){return this.action(this.urls.destroy,{...e,remove:!0},a)}async resetFilter(e=null){Object.assign(this.params,this.structure),this.query.isFilterActive=!1,await this.load(e)}}const f=(s,e)=>{const a=s.__vccOpts||s;for(const[r,i]of e)a[r]=i;return a},S={name:"WyxosButton",props:{loading:{default:!1,type:Boolean}}},x=t.createTextVNode("Submit"),k=t.createTextVNode("Processing..."),F={key:2,class:"fas fa-spinner fa-spin"};function P(s,e,a,r,i,l){const u=t.resolveComponent("o-button");return t.openBlock(),t.createBlock(u,{disabled:a.loading},{default:t.withCtx(()=>[a.loading?t.createCommentVNode("",!0):t.renderSlot(s.$slots,"default",{key:0},()=>[x]),a.loading?t.renderSlot(s.$slots,"loading",{key:1},()=>[k]):t.createCommentVNode("",!0),a.loading?(t.openBlock(),t.createElementBlock("i",F)):t.createCommentVNode("",!0)]),_:3},8,["disabled"])}const B=f(S,[["render",P]]),O={name:"WyxosCollection",props:{modelValue:{required:!0,type:Array}},emits:["update:modelValue"],data(){return{items:[]}},mounted(){this.items=this.modelValue},methods:{add(s){this.items.push(s),this.$emit("update:modelValue",this.items)},remove(s){this.items.splice(s,1),this.$emit("update:modelValue",this.items)}}},L=t.createElementVNode("ul",null,[t.createElementVNode("li")],-1);function C(s,e,a,r,i,l){return t.renderSlot(s.$slots,"default",t.normalizeProps(t.guardReactiveProps({add:l.add,remove:l.remove,items:i.items})),()=>[L])}const W=f(O,[["render",C]]),j={name:"WyxosDatepicker",props:{modelValue:{required:!0,type:[null,String]},displayFormat:{type:String,default:"DD/MM/YYYY"},submitFormat:{type:String,default:"YYYY-MM-DD"}},emits:["update:modelValue"],data(){return{query:null}},mounted(){this.modelValue&&(this.query=y.default(this.modelValue,this.submitFormat)._d)},methods:{dateFormatter(s){return s?y.default(s).format(this.displayFormat):null},updateQuery(){this.$emit("update:modelValue",this.query?y.default(this.query).format(this.submitFormat):null)}}};function N(s,e,a,r,i,l){const u=t.resolveComponent("o-datepicker");return t.openBlock(),t.createBlock(u,{modelValue:i.query,"onUpdate:modelValue":[e[0]||(e[0]=n=>i.query=n),l.updateQuery],"date-formatter":l.dateFormatter},null,8,["modelValue","date-formatter","onUpdate:modelValue"])}const T=f(j,[["render",N]]),E={name:"WyxosForm",props:{form:{type:Object,required:!0}},emits:["submit"]},A=t.createTextVNode(" An error occurred. Try again? ");function v(s,e,a,r,i,l){const u=t.resolveComponent("o-loading"),n=t.resolveComponent("o-button");return t.openBlock(),t.createElementBlock("div",null,[a.form.isLoaded.value?(t.openBlock(),t.createElementBlock("form",{key:0,class:"form",onSubmit:e[0]||(e[0]=t.withModifiers(c=>s.$emit("submit"),["prevent"]))},[t.renderSlot(s.$slots,"default")],32)):t.createCommentVNode("",!0),t.createVNode(u,{active:a.form.isLoading.value},null,8,["active"]),!a.form.isLoaded.value&&!a.form.isLoading.value?(t.openBlock(),t.createBlock(n,{key:1,onClick:e[1]||(e[1]=c=>a.form.load())},{default:t.withCtx(()=>[A]),_:1})):t.createCommentVNode("",!0)])}const z=f(E,[["render",v]]),I={name:"WyxosImage",props:{src:{type:[File,String],required:!0},resize:{type:Object,default:null}},data(){return{width:0,height:0}},mounted(){this.loadImage()},methods:{loadImage(){return typeof this.src=="object"?this.loadFile():this.loadPath()},loadFile(){const s=new FileReader;s.onload=e=>{const a=e.target.result;this.$refs.image.src=a,this.width=this.resize?this.resize.width:a.width,this.height=this.resize?this.resize.height:a.height},s.readAsDataURL(this.src)},loadPath(){const s=new Image;s.onload=()=>{this.$refs.image.src=this.src,this.width=this.resize?this.resize.width:s.width,this.height=this.resize?this.resize.height:s.height},s.src=this.src}}},D=["width","height"];function Y(s,e,a,r,i,l){return t.openBlock(),t.createElementBlock("img",{ref:"image",src:"",alt:"",width:i.width,height:i.height},null,8,D)}const M=f(I,[["render",Y]]),J={name:"WyxosInput",props:{label:{type:String,default:""},name:{type:String,required:!0},bag:{type:String,default:"default"}},setup(){return{errors:b()}},computed:{inputAttrs(){const s=this.$attrs;return Object.keys(s).forEach(e=>{["class"].includes(e)||s[e]}),s}}};function R(s,e,a,r,i,l){const u=t.resolveComponent("o-input"),n=t.resolveComponent("o-field");return t.openBlock(),t.createBlock(n,t.mergeProps({label:a.label},r.errors.get(a.name,a.bag)),{default:t.withCtx(()=>[t.createVNode(u,t.mergeProps(s.$attrs,{onFocus:e[0]||(e[0]=c=>r.errors.clear(a.name,a.bag))}),null,16)]),_:1},16,["label"])}const U=f(J,[["render",R]]),Q={name:"WyxosTags",props:{path:{type:String,required:!0},modelValue:{type:Array,required:!0},formatter:{type:Function,required:!0},excludeFormatter:{type:Function,default:null},restoreFormatter:{type:Function,default:s=>s},payloadFormatter:{type:Function,default:s=>s}},emits:["update:modelValue"],setup(){return{search:p.create()}},data(){return{query:[]}},async mounted(){if(this.modelValue&&this.modelValue.length){const{result:s}=await this.search.restore(this.path,this.restoreFormatter({values:this.modelValue}));this.query=s,this.$emit("update:modelValue",this.query.map(e=>this.formatter(e)))}},methods:{searchTags(s){return this.search.search(this.path,this.payloadFormatter({value:s,exclude:this.query.map(e=>e.id)}))},addedTag(){const s=this.query.map(e=>this.formatter(e));console.log("r",s),this.$emit("update:modelValue",s)},removedTag(){const s=this.query.map(e=>this.formatter(e));console.log("r",s),this.$emit("update:modelValue",s)},reset(){this.query=[],this.$emit("update:modelValue",this.query)}}};function H(s,e,a,r,i,l){const u=t.resolveComponent("o-inputitems");return t.openBlock(),t.createBlock(u,t.mergeProps(s.$attrs,{modelValue:i.query,"onUpdate:modelValue":e[0]||(e[0]=n=>i.query=n),data:r.search.result.value,"open-on-focus":!0,autocomplete:"",onAdd:e[1]||(e[1]=n=>l.addedTag(n)),onRemove:e[2]||(e[2]=n=>l.removedTag(n)),onFocus:e[3]||(e[3]=n=>l.searchTags()),onTyping:e[4]||(e[4]=n=>l.searchTags(n))}),null,16,["modelValue","data"])}const G=f(Q,[["render",H]]);o.AutoCompleteSearch=p,o.FormBuilder=_,o.ResourceList=$,o.WyxosButton=B,o.WyxosCollection=W,o.WyxosDatepicker=T,o.WyxosForm=z,o.WyxosImage=M,o.WyxosInput=U,o.WyxosTags=G,o.useFormErrors=b,Object.defineProperties(o,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
